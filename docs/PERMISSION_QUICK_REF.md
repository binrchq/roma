# æƒé™ç³»ç»Ÿå¿«é€Ÿå‚è€ƒ

## ğŸ¯ äº”çº§è§’è‰²å¯¹ç…§è¡¨

| è§’è‰² | çº§åˆ« | ç”¨æˆ·ç®¡ç† | èµ„æºç®¡ç† | èµ„æºä½¿ç”¨ | èŒƒå›´é™åˆ¶ | é€‚ç”¨äººå‘˜ |
|------|------|----------|----------|----------|----------|----------|
| **super** | 5â­ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | æ—  | CTO/ç³»ç»Ÿç®¡ç†å‘˜ |
| **system** | 4â­ | âŒ | âœ… å¢åˆ æ”¹æŸ¥ | âœ… ä½¿ç”¨ | æ—  | è¿ç»´è´Ÿè´£äºº |
| **ops** | 3â­ | âŒ | âŒ | âœ… æŸ¥çœ‹+ä½¿ç”¨ | å·²åˆ†é… | è¿ç»´å·¥ç¨‹å¸ˆ |
| **ordinary** | 2â­ | âŒ | âŒ | ğŸ‘ï¸ åªè¯» | æ’é™¤å¤–å›´ | å¼€å‘/æµ‹è¯• |
| **trial** | 1â­ | âŒ | âŒ | ğŸ”’ è¯•ç”¨èµ„æº | ä»… trial | è¯•ç”¨ç”¨æˆ· |

## ğŸ”‘ æ“ä½œæƒé™çŸ©é˜µ

| æ“ä½œ | super | system | ops | ordinary | trial |
|------|-------|--------|-----|----------|-------|
| **ç”¨æˆ·ç®¡ç†** |
| æ·»åŠ ç”¨æˆ· | âœ… | âŒ | âŒ | âŒ | âŒ |
| åˆ é™¤ç”¨æˆ· | âœ… | âŒ | âŒ | âŒ | âŒ |
| ä¿®æ”¹ç”¨æˆ· | âœ… | âŒ | âŒ | âŒ | âŒ |
| **èµ„æºç®¡ç†** |
| æ·»åŠ èµ„æº | âœ… | âœ… | âŒ | âŒ | âŒ |
| åˆ é™¤èµ„æº | âœ… | âœ… | âŒ | âŒ | âŒ |
| ä¿®æ”¹èµ„æº | âœ… | âœ… | âŒ | âŒ | âŒ |
| **èµ„æºè®¿é—®** |
| æŸ¥çœ‹èµ„æº | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å·²åˆ†é… | âœ… éå¤–å›´ | âœ… ä»…è¯•ç”¨ |
| åˆ—å‡ºèµ„æº | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å·²åˆ†é… | âœ… éå¤–å›´ | âœ… ä»…è¯•ç”¨ |
| è¿æ¥èµ„æº | âœ… | âœ… | âœ… | âŒ | âœ… è¯•ç”¨ |
| æ‰§è¡Œå‘½ä»¤ | âœ… | âœ… | âœ… | âŒ | âœ… è¯•ç”¨ |

## ğŸ“‹ æƒé™è§„åˆ™è¯­æ³•

```
operation:ç›®æ ‡-èŒƒå›´.(æ“ä½œåˆ—è¡¨)
```

### å®Œæ•´ç¤ºä¾‹

```toml
# è¯­æ³•æ¨¡æ¿
operation:TARGET-SCOPE.(OP1|OP2|OP3)

# å®é™…ä¾‹å­
operation:resource.(get|list|use)           # ops è§’è‰²
operation:resource-(*peripheral).(get|list) # ordinary è§’è‰²
operation:resource-(*trial).(get|list|use)  # trial è§’è‰²
```

### ç»„æˆéƒ¨åˆ†

| éƒ¨åˆ† | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `operation:` | å›ºå®šå‰ç¼€ | `operation:` |
| `TARGET` | user/resource | `user`, `resource` |
| `-SCOPE` | å¯é€‰èŒƒå›´ | `-(*peripheral)`, `-(*trial)` |
| `(OPS)` | æ“ä½œåˆ—è¡¨ | `(add\|delete\|get)` |

### èŒƒå›´æ ‡è®°

| æ ‡è®° | å«ä¹‰ | æ•ˆæœ |
|-----|------|------|
| æ—  | æ‰€æœ‰èµ„æº | ä¸é™åˆ¶ |
| `-(*scope)` | æ’é™¤è§„åˆ™ | **ä¸åŒ…æ‹¬** scope èµ„æº |
| `-(scope)` | åŒ…å«è§„åˆ™ | **åªåŒ…æ‹¬** scope èµ„æº |

## ğŸ·ï¸ èµ„æºæ ‡ç­¾

| æ ‡ç­¾ | è¯´æ˜ | å‘½åè§„èŒƒ | è°èƒ½è®¿é—® |
|------|------|----------|----------|
| `trial` | è¯•ç”¨ç¯å¢ƒ | trial-*, test-* | super, system, ops, trial |
| `peripheral` | å¤–å›´è®¾å¤‡ | edge-*, iot-* | super, system, ops |
| æ— æ ‡ç­¾ | æ™®é€šèµ„æº | prod-*, dev-* | super, system, ops, ordinary |

## ğŸš€ å¸¸ç”¨åœºæ™¯

### åœºæ™¯1: æ–°å‘˜å·¥å…¥èŒ

```bash
# å®ä¹ ç”Ÿ â†’ trial è§’è‰²
è§’è‰²: trial
æƒé™: åªèƒ½è®¿é—® trial-* èµ„æº
å¯ä»¥: æŸ¥çœ‹ã€è¿æ¥ã€æ‰§è¡Œå‘½ä»¤ï¼ˆä»…è¯•ç”¨èµ„æºï¼‰
ä¸èƒ½: è®¿é—®ç”Ÿäº§èµ„æºã€ä¿®æ”¹é…ç½®

# æ­£å¼å‘˜å·¥ â†’ ordinary è§’è‰²
è§’è‰²: ordinary
æƒé™: æŸ¥çœ‹éå¤–å›´èµ„æº
å¯ä»¥: æŸ¥çœ‹å¼€å‘/ç”Ÿäº§èµ„æºä¿¡æ¯
ä¸èƒ½: è¿æ¥èµ„æºã€æ‰§è¡Œå‘½ä»¤
```

### åœºæ™¯2: è¿ç»´å›¢é˜Ÿ

```bash
# åˆçº§è¿ç»´ â†’ ops è§’è‰²
è§’è‰²: ops
æƒé™: æŸ¥çœ‹+ä½¿ç”¨å·²åˆ†é…èµ„æº
å¯ä»¥: SSH è¿æ¥ã€æ‰§è¡Œå‘½ä»¤ã€æŸ¥çœ‹æ—¥å¿—
ä¸èƒ½: æ·»åŠ /åˆ é™¤èµ„æº

# è¿ç»´è´Ÿè´£äºº â†’ system è§’è‰²
è§’è‰²: system
æƒé™: èµ„æºç®¡ç†æƒé™
å¯ä»¥: æ·»åŠ /åˆ é™¤/ä¿®æ”¹æ‰€æœ‰èµ„æº
ä¸èƒ½: ç®¡ç†ç”¨æˆ·è´¦å·
```

### åœºæ™¯3: ä¸´æ—¶è®¿å®¢

```bash
# å¤–éƒ¨é¡¾é—® â†’ trial è§’è‰²
è§’è‰²: trial
èµ„æº: trial-demo-01, trial-demo-02
æœŸé™: 7 å¤©
æƒé™: ä»…è®¿é—®æ¼”ç¤ºç¯å¢ƒ
```

## ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•

### âœ… æƒé™åˆ†é…

- [ ] æ–°ç”¨æˆ·é»˜è®¤æœ€ä½æƒé™
- [ ] æŒ‰éœ€æå‡æƒé™
- [ ] å®šæœŸå®¡æŸ¥æƒé™
- [ ] ç¦»èŒå‘˜å·¥åŠæ—¶æ’¤é”€

### âœ… èµ„æºæ ‡ç­¾

- [ ] è¯•ç”¨èµ„æºæ ‡è®° `trial`
- [ ] å¤–å›´è®¾å¤‡æ ‡è®° `peripheral`
- [ ] ç»Ÿä¸€å‘½åè§„èŒƒ
- [ ] å®šæœŸæ¸…ç†æ— æ•ˆèµ„æº

### âœ… å®¡è®¡æ—¥å¿—

- [ ] å¯ç”¨æ‰€æœ‰æ“ä½œæ—¥å¿—
- [ ] ç›‘æ§å¤±è´¥çš„è®¿é—®å°è¯•
- [ ] è®¾ç½®å¼‚å¸¸å‘Šè­¦
- [ ] ä¿ç•™ 90 å¤©ä»¥ä¸Šæ—¥å¿—

## ğŸ“Š æƒé™å†³ç­–æµç¨‹

```
ç”¨æˆ·è¯·æ±‚æ“ä½œ
    â†“
ã€æ£€æŸ¥1ã€‘ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Ÿ
    â†“ YES
ã€æ£€æŸ¥2ã€‘ç”¨æˆ·æ˜¯å¦å¯ç”¨ï¼Ÿ
    â†“ YES
ã€æ£€æŸ¥3ã€‘ç”¨æˆ·è§’è‰²æƒé™ï¼Ÿ
    â”œâ”€ super    â†’ é€šè¿‡æ‰€æœ‰æ£€æŸ¥
    â”œâ”€ system   â†’ æ£€æŸ¥èµ„æºæƒé™
    â”œâ”€ ops      â†’ æ£€æŸ¥èµ„æºæƒé™ + åˆ†é…
    â”œâ”€ ordinary â†’ æ£€æŸ¥èµ„æºæƒé™ + åˆ†é… + èŒƒå›´
    â””â”€ trial    â†’ æ£€æŸ¥èµ„æºæƒé™ + åˆ†é… + èŒƒå›´
    â†“
ã€æ£€æŸ¥4ã€‘æ“ä½œç±»å‹å…è®¸ï¼Ÿ
    â”œâ”€ add/delete/update â†’ ä»… super/system
    â”œâ”€ use â†’ super/system/ops/trial
    â””â”€ get/list â†’ æ‰€æœ‰è§’è‰²
    â†“
ã€æ£€æŸ¥5ã€‘èµ„æºèŒƒå›´åŒ¹é…ï¼Ÿ
    â”œâ”€ ordinary â†’ æ’é™¤ peripheral
    â”œâ”€ trial â†’ åªåŒ…æ‹¬ trial
    â””â”€ å…¶ä»– â†’ æ— é™åˆ¶
    â†“
ã€æ£€æŸ¥6ã€‘èµ„æºå·²åˆ†é…ï¼Ÿï¼ˆé super/systemï¼‰
    â†“ YES
âœ… å…è®¸æ“ä½œ
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è§’è‰²åˆ†é…

```
æ¨èé…ç½®:
- å®ä¹ ç”Ÿ/è¯•ç”¨     â†’ trial
- å¼€å‘äººå‘˜        â†’ ordinary
- æµ‹è¯•äººå‘˜        â†’ ordinary
- åˆçº§è¿ç»´        â†’ ops
- é«˜çº§è¿ç»´        â†’ ops
- è¿ç»´è´Ÿè´£äºº      â†’ system
- æŠ€æœ¯æ€»ç›‘/CTO    â†’ super
```

### 2. èµ„æºå‘½å

```
å‘½åè§„èŒƒ:
- è¯•ç”¨: trial-{service}-{num}
- æµ‹è¯•: test-{service}-{num}
- å¼€å‘: dev-{service}-{num}
- ç”Ÿäº§: prod-{service}-{num}
- å¤–å›´: edge-{service}-{num}

ç¤ºä¾‹:
âœ… trial-web-01
âœ… prod-db-master
âœ… edge-node-001
âŒ server1 (ä¸æ˜ç¡®)
```

### 3. æƒé™å®¡è®¡

```sql
-- æ¯å‘¨è¿è¡Œ
-- 1. æŸ¥æ‰¾é«˜æƒé™ç”¨æˆ·
SELECT u.username, r.name as role
FROM users u
JOIN user_roles ur ON u.id = ur.user_id
JOIN roles r ON ur.role_id = r.id
WHERE r.name IN ('super', 'system')
ORDER BY r.name;

-- 2. æŸ¥æ‰¾å¼‚å¸¸è®¿é—®
SELECT user_id, COUNT(*) as failed_attempts
FROM access_logs
WHERE status = 'failed'
  AND accessed_at > NOW() - INTERVAL 7 DAY
GROUP BY user_id
HAVING failed_attempts > 20;

-- 3. æŸ¥æ‰¾æœªä½¿ç”¨çš„èµ„æº
SELECT r.id, r.name, r.type
FROM resources r
LEFT JOIN access_logs al ON r.id = al.resource_id
WHERE al.id IS NULL
  OR al.accessed_at < NOW() - INTERVAL 30 DAY;
```

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¸´æ—¶æå‡æƒé™ï¼Ÿ

```bash
# æ–¹æ³•1: åˆ›å»ºä¸´æ—¶è§’è‰²
UPDATE user_roles SET role_id = (SELECT id FROM roles WHERE name = 'system')
WHERE user_id = 123;

# æ–¹æ³•2: ä¸´æ—¶åˆ†é…èµ„æº
INSERT INTO user_resources (user_id, resource_id) VALUES (123, 456);

# âš ï¸ è®°å¾—æ“ä½œå®Œæˆåæ¢å¤ï¼
```

### Q: å¦‚ä½•æ‰¹é‡æˆæƒèµ„æºï¼Ÿ

```bash
# ä¸ºè¿ç»´å›¢é˜Ÿæˆæƒæ‰€æœ‰ç”Ÿäº§æœåŠ¡å™¨
INSERT INTO user_resources (user_id, resource_id)
SELECT u.id, r.id
FROM users u
CROSS JOIN resources r
WHERE u.id IN (SELECT user_id FROM user_roles WHERE role_id = (SELECT id FROM roles WHERE name = 'ops'))
  AND r.name LIKE 'prod-%';
```

### Q: å¦‚ä½•æ’¤é”€æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æƒé™ï¼Ÿ

```bash
# ç¦ç”¨ç”¨æˆ·
UPDATE users SET status = 'disabled' WHERE id = 123;

# æˆ–åˆ é™¤æ‰€æœ‰è§’è‰²
DELETE FROM user_roles WHERE user_id = 123;

# æˆ–åˆ é™¤æ‰€æœ‰èµ„æºåˆ†é…
DELETE FROM user_resources WHERE user_id = 123;
```

---

**åˆç†çš„æƒé™åˆ†é… = å®‰å…¨ + æ•ˆç‡** ğŸ”âœ¨


